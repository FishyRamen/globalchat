<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>tonkotsu.online</title>

  <link rel="icon" href="https://em-content.zobj.net/source/google/439/steaming-bowl_1f35c.png" />

  <style>
    :root{
      --bg:#07090d;
      --panel:#0b0e14;
      --panel2:#0d111a;
      --line:rgba(140,160,200,.18);
      --text:rgba(235,240,255,.92);
      --muted:rgba(154,163,183,.86);
      --muted2:rgba(154,163,183,.68);
      --shadow:0 18px 60px rgba(0,0,0,.55);
      --r:18px;
      --r2:14px;
      --pad:14px;
      --btn:#121829;
      --btn2:#0f1523;
      --danger:#ff5c7a;
      --ok:#6ff2b2;
      --warn:#ffd278;
      --accent:#8fb3ff;
      --accent2:#b8c7ff;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:radial-gradient(1200px 900px at 20% 10%, rgba(70,90,140,.18), transparent 50%), var(--bg); color:var(--text); font-family:var(--font); }
    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }
    button,input,textarea{ font-family:inherit; }

    /* layout */
    #loginWrap{ min-height:100%; display:flex; align-items:center; justify-content:center; padding:26px; }
    #loginCard{
      width:min(940px, 100%);
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      padding:18px;
      border-radius:22px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      backdrop-filter: blur(12px);
    }
    @media (max-width: 860px){
      #loginCard{ grid-template-columns: 1fr; }
    }
    .card{ background:rgba(10,12,16,.72); border:1px solid var(--line); border-radius:20px; padding:18px; box-shadow: 0 12px 40px rgba(0,0,0,.35); }
    .h1{ font-size:30px; font-weight:800; letter-spacing:.2px; margin:0 0 6px; }
    .sub{ color:var(--muted); font-size:14px; line-height:1.45; }
    .beta{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid rgba(140,160,200,.22); background:rgba(10,12,16,.8); color:var(--muted); font-size:12px; margin-top:12px; width:max-content; }
    .betaDot{ width:8px; height:8px; border-radius:999px; background:var(--warn); box-shadow: 0 0 0 3px rgba(255,210,120,.18); }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; }
    .field{ width:100%; display:flex; flex-direction:column; gap:8px; margin-top:14px; }
    .label{ font-size:12px; color:var(--muted2); letter-spacing:.2px; }
    .input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      background:rgba(12,14,20,.95);
      border:1px solid rgba(140,160,200,.22);
      color:var(--text);
      outline:none;
    }
    .input:focus{ border-color:rgba(143,179,255,.5); box-shadow:0 0 0 3px rgba(143,179,255,.14); }

    .btn{
      padding:11px 12px;
      border-radius:14px;
      border:1px solid rgba(140,160,200,.22);
      background:linear-gradient(180deg, rgba(18,24,41,.95), rgba(14,18,30,.95));
      color:var(--text);
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, border-color .12s ease, filter .12s ease;
    }
    .btn:hover{ filter:brightness(1.06); border-color:rgba(143,179,255,.35); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ border-color:rgba(143,179,255,.45); }
    .btn.danger{ border-color:rgba(255,92,122,.42); }
    .btn.ghost{ background:transparent; }
    .loginMsg{ margin-top:12px; color:var(--muted); font-size:13px; min-height:18px; }

    /* app shell */
    #app{ display:none; height:100%; width:100%; }
    #shell{
      height:100%;
      display:grid;
      grid-template-columns: 330px 1fr 240px;
      gap:12px;
      padding:12px;
    }
    @media (max-width: 980px){
      #shell{ grid-template-columns: 320px 1fr; }
      #rightPane{ display:none; }
    }
    @media (max-width: 760px){
      #shell{ grid-template-columns: 1fr; }
      #leftPane{ display:none; }
      #rightPane{ display:none; }
    }
    .pane{
      background:rgba(10,12,16,.72);
      border:1px solid var(--line);
      border-radius:20px;
      box-shadow: 0 14px 44px rgba(0,0,0,.35);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .paneHead{
      padding:12px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:rgba(8,10,14,.72);
      backdrop-filter: blur(10px);
    }
    .brand{ font-weight:800; letter-spacing:.2px; display:flex; align-items:center; gap:10px; }
    .brand small{ color:var(--muted2); font-weight:600; }
    .headBtns{ display:flex; gap:8px; align-items:center; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid rgba(140,160,200,.22);
      background:rgba(10,12,16,.8);
      color:var(--muted);
      font-size:12px;
    }
    .pDot{ width:10px; height:10px; border-radius:999px; background:#6ff2b2; }
    .pDot.idle{ background:#ffd278; }
    .pDot.dnd{ background:#ff5c7a; }
    .pDot.inv{ background:rgba(154,163,183,.55); }

    /* left threads */
    .leftTools{ padding:12px; display:flex; flex-direction:column; gap:10px; border-bottom:1px solid var(--line); }
    .toolRow{ display:flex; gap:10px; }
    #threadList{ padding:10px; overflow:auto; min-height:0; }
    .thread{
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(140,160,200,.12);
      background:rgba(12,14,20,.72);
      cursor:pointer;
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom:10px;
      transition: border-color .12s ease, filter .12s ease;
    }
    .thread:hover{ border-color:rgba(143,179,255,.28); filter:brightness(1.05); }
    .thread.active{ border-color:rgba(143,179,255,.55); }
    .threadTop{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .threadName{ font-weight:800; font-size:13px; }
    .threadMeta{ font-size:11px; color:var(--muted2); }
    .threadLast{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* center */
    #centerHead{ padding:12px; border-bottom:1px solid var(--line); }
    #centerH{ font-weight:900; font-size:16px; }
    #centerS{ color:var(--muted); font-size:12px; margin-top:2px; }
    #centerBody{ padding:12px; overflow:auto; min-height:0; }
    .msg{
      padding:10px 10px;
      border-radius:16px;
      border:1px solid rgba(140,160,200,.12);
      background:rgba(12,14,20,.60);
      margin-bottom:10px;
    }
    .msgTop{ display:flex; justify-content:space-between; gap:10px; align-items:center; }
    .msgUser{ font-weight:900; font-size:13px; }
    .msgTime{ color:var(--muted2); font-size:11px; }
    .msgBody{ margin-top:6px; color:rgba(235,240,255,.92); font-size:13px; line-height:1.45; white-space:pre-wrap; word-break:break-word; }
    .chips{ margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      display:inline-flex; align-items:center; gap:6px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(140,160,200,.20);
      font-size:11px;
      color:var(--muted);
      background:rgba(8,10,14,.45);
    }
    .chip.err{ border-color:rgba(255,92,122,.35); color:rgba(255,140,160,.95); }
    .chip.ann{ border-color:rgba(255,210,120,.38); color:rgba(255,230,180,.95); }

    /* composer */
    #composer{
      border-top:1px solid var(--line);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      background:rgba(8,10,14,.6);
    }
    #composerRow{ display:flex; gap:10px; }
    #msgInput{ flex:1; resize:none; height:44px; }
    #cooldownRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    #cooldownText{ font-size:12px; color:var(--muted2); min-height:14px; }
    #cooldownTrack{
      width:220px; height:10px;
      border-radius:999px;
      background:rgba(140,160,200,.10);
      border:1px solid rgba(140,160,200,.16);
      overflow:hidden;
    }
    #cooldownBar{
      height:100%;
      width:0%;
      opacity:0;
      background:linear-gradient(90deg, rgba(143,179,255,.9), rgba(184,199,255,.9));
      transition: width .08s linear, opacity .18s ease;
    }
    .cd-red #cooldownBar{ background:linear-gradient(90deg, rgba(255,92,122,.95), rgba(255,170,190,.92)); }
    @keyframes shake{
      0%{ transform:translateX(0); }
      25%{ transform:translateX(-6px); }
      50%{ transform:translateX(6px); }
      75%{ transform:translateX(-4px); }
      100%{ transform:translateX(0); }
    }
    .cd-shake{ animation:shake .18s ease 0s 2; }

    /* right online users (compact) */
    #onlineUsers{ padding:12px; overflow:auto; min-height:0; }
    .mini{
      display:flex; gap:10px; align-items:center;
      padding:10px;
      border-radius:14px;
      border:1px solid rgba(140,160,200,.12);
      background:rgba(12,14,20,.60);
      margin-bottom:10px;
    }
    .mini .t{ font-weight:900; font-size:13px; line-height:1.1; }
    .mini .d{ color:var(--muted2); font-size:11px; margin-top:3px; }

    /* modal */
    #backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      z-index:9997;
    }
    #backdrop.show{ display:flex; }
    #modal{
      width:min(680px, 100%);
      border-radius:22px;
      background:rgba(10,12,16,.92);
      border:1px solid rgba(140,160,200,.24);
      box-shadow:var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    #modalHead{
      padding:12px 12px;
      border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      background:rgba(8,10,14,.7);
    }
    #modalTitle{ font-weight:900; }
    #modalClose{
      width:36px; height:36px;
      border-radius:12px;
      border:1px solid rgba(140,160,200,.22);
      background:rgba(12,14,20,.8);
      color:var(--text);
      cursor:pointer;
    }
    #modalBody{ padding:14px; color:var(--text); }
    #modalFoot{ padding:12px; border-top:1px solid var(--line); display:flex; justify-content:flex-end; gap:10px; }

    /* context menu */
    #ctx{
      position:fixed;
      z-index:9999;
      display:none;
      min-width:220px;
      border-radius:16px;
      background:rgba(10,12,16,.95);
      border:1px solid rgba(140,160,200,.22);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    #ctx.show{ display:block; }
    .ctxItem{
      padding:12px 12px;
      display:flex; justify-content:space-between; align-items:center;
      cursor:pointer;
      border-bottom:1px solid rgba(140,160,200,.10);
      font-size:13px;
      color:var(--text);
    }
    .ctxItem:last-child{ border-bottom:none; }
    .ctxItem:hover{ background:rgba(143,179,255,.08); }
    .ctxItem.danger:hover{ background:rgba(255,92,122,.10); }
    .ctxItem small{ color:var(--muted2); font-weight:700; }

    /* loading overlay */
    #loading{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      z-index:9996;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
    }
    #loading.show{ display:flex; }
    #loadCard{ width:min(520px, 92%); border-radius:22px; padding:16px; border:1px solid var(--line); background:rgba(10,12,16,.86); box-shadow:var(--shadow); }
    #loadMsg{ font-weight:900; font-size:16px; }
    #loadTag{ margin-top:6px; color:var(--muted2); font-size:12px; }

    /* custom cursor (NO TRAIL) */
    #cursor{
      position:fixed;
      left:0; top:0;
      width:14px; height:14px;           /* smaller */
      border-radius:999px;
      border:2px solid rgba(235,240,255,.75);
      box-shadow:0 0 0 6px rgba(143,179,255,.10);
      transform: translate(-50%,-50%);
      pointer-events:none;
      z-index:10000;
      display:none;
    }

    /* force-hide system cursor only when data-cursor="custom" */
    html[data-cursor="custom"], html[data-cursor="custom"] * { cursor:none !important; }
  </style>
</head>

<body>
  <!-- custom cursor -->
  <div id="cursor"></div>

  <!-- login -->
  <div id="loginWrap">
    <div id="loginCard">
      <div class="card">
        <div class="h1">tonkotsu.online</div>
        <div class="sub">
          Compact black chat client. Beta build. If anything breaks, check the browser console + server logs.
        </div>
        <div class="beta"><span class="betaDot"></span><span>beta / early access</span></div>

        <div class="field">
          <div class="label">Username</div>
          <input id="loginUser" class="input" placeholder="username" autocomplete="username" />
        </div>
        <div class="field">
          <div class="label">Password</div>
          <input id="loginPass" class="input" placeholder="password" type="password" autocomplete="current-password" />
        </div>

        <div class="row">
          <button id="btnLogin" class="btn primary">Sign in</button>
          <button id="btnGuest" class="btn">Guest</button>
        </div>

        <div id="loginMsg" class="loginMsg">Sign in or use Guest.</div>
      </div>

      <div class="card">
        <div style="font-weight:900; font-size:14px;">Info</div>
        <div class="sub" style="margin-top:10px;">
          • No profile pictures anywhere.<br/>
          • Right-click messages to Edit/Delete (1 min) or Report to your moderation bot.<br/>
          • Online users list is unique per account (multiple tabs won’t duplicate).<br/>
          • Cooldown bar prevents spam; red shake on violation.<br/>
          • XP system + leaderboard endpoint on server (wired, optional UI later).
        </div>
        <div style="margin-top:14px; color:var(--muted2); font-size:12px;">
          GitHub / Ko-fi links are in the bootstrap response if you want to render them later.
        </div>
      </div>
    </div>
  </div>

  <!-- app -->
  <div id="app">
    <div id="shell">
      <!-- left -->
      <div id="leftPane" class="pane">
        <div class="paneHead">
          <div class="brand">Messages <small id="leftSub">global / dm / groups</small></div>
          <div class="headBtns">
            <button id="btnSettings" class="btn ghost" title="Settings">Settings</button>
          </div>
        </div>
        <div class="leftTools">
          <div class="toolRow">
            <button id="btnAddFriend" class="btn">+ friend</button>
            <button id="btnNewGroup" class="btn">+ group</button>
          </div>
          <input id="searchThreads" class="input" placeholder="search…" />
        </div>
        <div id="threadList"></div>
      </div>

      <!-- center -->
      <div id="centerPane" class="pane">
        <div class="paneHead">
          <div class="brand">tonkotsu.online <small>beta</small></div>
          <div class="headBtns">
            <div class="pill" title="Presence">
              <span id="presenceDot" class="pDot"></span>
              <span id="presenceLabel">online</span>
            </div>
            <button id="btnUser" class="btn">Profile</button>
            <button id="btnLogout" class="btn danger">Logout</button>
          </div>
        </div>

        <div id="centerHead">
          <div id="centerH">Global</div>
          <div id="centerS">Public chat</div>
        </div>

        <div id="centerBody"></div>

        <div id="composer">
          <div id="composerRow">
            <textarea id="msgInput" class="input" placeholder="Message…"></textarea>
            <button id="btnSend" class="btn primary">Send</button>
          </div>
          <div id="cooldownRow">
            <div id="cooldownText"></div>
            <div id="cooldownTrack"><div id="cooldownBar"></div></div>
          </div>
          <div id="typingText" style="color:var(--muted2); font-size:12px; min-height:14px;"></div>
        </div>
      </div>

      <!-- right -->
      <div id="rightPane" class="pane">
        <div class="paneHead">
          <div class="brand">Online <small id="onlineCount">0</small></div>
          <div class="headBtns">
            <button id="btnPresenceOnline" class="btn ghost">online</button>
            <button id="btnPresenceIdle" class="btn ghost">idle</button>
            <button id="btnPresenceDnd" class="btn ghost">dnd</button>
            <button id="btnPresenceInv" class="btn ghost">invisible</button>
          </div>
        </div>
        <div id="onlineUsers"></div>
      </div>
    </div>
  </div>

  <!-- loading -->
  <div id="loading">
    <div id="loadCard">
      <div id="loadMsg">Loading…</div>
      <div id="loadTag">boot</div>
    </div>
  </div>

  <!-- modal -->
  <div id="backdrop">
    <div id="modal">
      <div id="modalHead">
        <div id="modalTitle"></div>
        <button id="modalClose">×</button>
      </div>
      <div id="modalBody"></div>
      <div id="modalFoot"></div>
    </div>
  </div>

  <!-- context menu -->
  <div id="ctx"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/script.js"></script>
</body>
</html>
